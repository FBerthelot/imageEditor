/**
 * Created by berthel on 02/01/15.
 */
"use strict";angular.module("SideNav",[]).directive("sideNavDir",["$rootScope","$mdSidenav",function(e,t){return{restrict:"E",replace:!0,templateUrl:"components/sidenav/sidenav.html",link:function(i){e.$on("toggleMenu",function(){t("left").toggle()}),i.close=function(){t("left").close()},i.clickOnButton=function(t){e.$emit("sideNavBtnClick",t)}}}}]),angular.module("resizeToolBox",[]).controller("resizeToolBoxCtrl",["$scope","$rootScope",function(e,t){e.resize=function(){t.$emit("resizeImg",e.width,e.height)}}]),angular.module("NavBar",[]).directive("navBarDir",["$rootScope",function(e){return{restrict:"E",replace:!0,templateUrl:"components/navbar/navbar.html",link:function(t){t.toggleMenu=function(){e.$emit("toggleMenu")},t.saveImg=function(){e.$emit("saveImg")}}}}]);var app=angular.module("imageResizer",["ngAnimate","ngTouch","ngSanitize","ui.router","ngMaterial","SideNav","NavBar","images-resizer","resizeToolBox"]);app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}).state("404",{url:"/404.html",templateUrl:"404.html"}),t.otherwise("/")}]),angular.module("imageResizer").controller("MainCtrl",["$scope","$rootScope","readLocalPicService","resizeService","$timeout","$mdBottomSheet",function(e,t,i,o,n,a){function l(){var e=m.getBoundingClientRect();e.right<window.innerWidth&&(m.width=window.innerWidth-e.left),e.bottom<window.innerHeight&&(m.height=window.innerWidth-e.top)}var m=document.getElementById("canvas"),r=m.getContext("2d");e.imageInitial=null,e.imageToModify=null,e.isImageToModify=!1,e.uploadFile=function(t){i.readFileInput(t).then(function(t){console.log("base",t),e.isImageToModify=!0,n(function(){l(),o.createImage(t).then(function(t){e.imageInitial=t,e.imageToModify=t,r.drawImage(t,0,0,t.width,t.height)})})},function(e){console.error(e)})},t.$on("resizeImg",function(t,i,n){console.log(e.imageToModify,"yuio"),o.resizeImage(e.imageToModify.src,{width:i,height:n},function(t,i){return t?void console.error(t):void o.createImage(i).then(function(t){e.imageToModify=t,r.clearRect(0,0,e.imageInitial.width,e.imageInitial.height),r.drawImage(t,0,0,t.width,t.height)})})}),t.$on("sideNavBtnClick",function(t,i){switch(i){case"resizeImg":a.show({templateUrl:"components/resizeToolBox/resizeToolBox.html",controller:"resizeToolBoxCtrl",locals:{width:e.image?e.image.width:null,height:e.image?e.image.height:null}})}}),t.$on("saveImg",function(){e.imageToModify&&(window.location.href=e.imageToModify.src.replace("image/png","image/octet-stream"))})}]),angular.module("imageResizer").run(["$templateCache",function(e){e.put("app/main/main.html",'<nav-bar-dir></nav-bar-dir><md-content><input name="uploadingImage" id="uploadingImage" ng-hide="isImageToModify" type="file" onchange="angular.element(this).scope().uploadFile(this)" ng-model="uploadingImage" accept="image/*" capture=""><canvas id="canvas" ng-show="isImageToModify" width="1837" height="650"></canvas></md-content>'),e.put("components/navbar/navbar.html",'<md-toolbar layout="row" layout-align="start center"><div><md-button aria-label="toggleMenu" ng-click="toggleMenu()" hide-gt-md=""><md-icon icon="assets/icons/ic_menu_48px.svg" style="width: 24px; height: 24px;"></md-icon></md-button></div><div class="md-toolbar-tools" flex="" fill-height="" layout="row">Resize an image</div><div><md-button aria-label="saveImg" class="md-fab mrgRight15" ng-click="saveImg()"><md-icon icon="assets/icons/ic_save_48px.svg" fill="white" style="width: 40px; height: 40px;"></md-icon></md-button></div></md-toolbar>'),e.put("components/resizeToolBox/resizeToolBox.html",'<md-bottom-sheet><form name="resizeForm" layout="row" layout-align="center center"><md-input-container class="mrgRight15"><label>Width</label> <input type="number" step="any" name="width" ng-model="width" required=""></md-input-container><md-input-container class="mrgRight15"><label>Height</label> <input type="number" step="any" name="height" ng-model="height" required=""></md-input-container><md-button ng-click="resize()" class="md-raised md-primary">let\'s resize !</md-button></form></md-bottom-sheet>'),e.put("components/sidenav/sidenav.html",'<md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$media(\'gt-md\')"><md-toolbar><h1 class="md-toolbar-tools">Image Editor</h1></md-toolbar><md-content class="md-padding"><md-button ng-click="close()" class="md-primary" fill="white" hide-gt-md="">Close menu</md-button><md-button ng-click="clickOnButton(\'resizeImg\')">Resize image</md-button></md-content></md-sidenav>')}]);